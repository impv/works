---
import ContentPageLayout from "@/layouts/ContentPageLayout.astro";
import { newtApiClient } from "@/api/newtApiClient";
import type { Work } from "@/types/newt";
import CustomTypography from "@/components/CustomTypography/index.astro";

const client = newtApiClient();
const { items: works } = await client.getContents<Work>({
  appUid: "website",
  modelUid: "work",
});
---
<ContentPageLayout title="Works">
  <section class="body">
    <CustomTypography as="h1" variant="title-large">Works</CustomTypography>

    <div class="work-index">
      {
        works.map((work) => (
          <a href={`/works/${work.slug}`} class="work-index-item" data-astro-prefetch>
            <div class="work-thumbnail">
              <img src={`${work.coverImage.src}?format=webp&fit=inside&width=515&height=515`} srcset={`${work.coverImage?.src}?format=webp&fit=inside&width=1030&height=1030 2x`} alt={work.coverImage.altText} width={work.coverImage.width} height={work.coverImage.height} transition:name={`cover-${work.slug}`} />
            </div>
            <CustomTypography as="h2" variant="body-large">{work.title}</CustomTypography>
          </a>
        ))
      }
    </div>
  </section>
</ContentPageLayout>

<style>
.body {
  display: block grid;
  gap: var(--gap-medium);
}

.work-index {
  display: grid;
  gap: var(--gap-small);
  list-style: none;
  grid-template-columns: repeat(auto-fill, minmax(270px, 1fr));
}

.work-index-item {
  display: grid;
  grid-template-rows: subgrid;
  gap: 0.8rem;
  grid-row: span 2;
  color: var(--fg-subtle);
  text-decoration: none;
}

.work-index-item:hover {
  color: var(--fg-subtle-hover);
}

.work-thumbnail {
  overflow: hidden;
  aspect-ratio: 1 / 1;
  padding: 2.4rem;
  background-color: var(--bg-muted);
}

.work-index-item:hover .work-thumbnail {
  background-color: var(--bg-muted-hover);
}

.work-thumbnail img,
.work-thumbnail video {
  width: 100%;
  height: 100%;
  object-fit: contain;
}
</style>